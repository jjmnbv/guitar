{{#extend "main"}}

<!-- 页面meta  作者，关键字，描述 -->
{{#content "meta"}}
<meta content="" name="description"/>
<meta content="" name="author"/>
<meta content="" name="keyword"/>
{{/content}}

<!-- 页面 title -->
{{#content "title"}}
<title>流程引擎 | 流程管理</title>
{{/content}}

<!-- css插件 -->
{{#content "css-plugins"}}
<!-- @Override -->
{{/content}}

<!-- 自定义css -->
{{#content "css-main"}}
<!-- @Override -->
<link rel="stylesheet" href="{{path.app}}/css/cb/common-form.css"/>
<link rel="stylesheet" href="{{path.app}}/css/cb/modal-form.css"/>
{{/content}}

<!-- 首屏渲染数据js-loader -->
{{#content "js-loader"}}
<!-- @Override -->
<!--加载数据字典-->
{{/content}}

<!-- js插件 -->
{{#content "js-plugins"}}
<!-- @Override -->
{{/content}}

<!-- 自定义js -->
{{#content "js-main"}}
<!-- @Override -->
<script src="{{path.app}}/js/bpm/workflow_bpm_list.js"></script>
<script src="${self.path.app}/js/bpm/activiti.js"></script>
<script src="{{path.app}}/js/bpm/urls.js"></script>
{{/content}}

<!-- 页面主体 -->
{{#content "content-main"}}
<!-- @Override -->
{{/content}}

<!-- 分页查询条件 pagination-form -->
{{#content "pagination-form"}}
<!-- @Override -->
<!--页面查询条件-->
<form class="bsdForm pagination-form" id="loanTypeForm">
    <div class="form-group">
        <label class="control-label" >流程名称</label>
        <div>
            <input type="text" class="form-control" name="name"  >
        </div>
    </div>
    <div class="form-group">
        <label class="control-label" for="description">流程描述</label>
        <div>
            <input type="text" class="form-control" name="description" id="description" >
        </div>
    </div>
</form>
{{/content}}

<!-- 分页表格和分页页码 pagination-container -->
{{#content "pagination-container"}}
<!-- @Override -->
<!--页面列表-->
<div class="portlet box reg">
    <div class="portlet-title">
        <div class="caption">流程列表</div>
        <div class=" actions clearfix">
            <a href="javascript:;" title="新建" id="add"  class="add-sign"></a>
            <a href="javascript:;" title="复制" id="copy" class="copy-sign"></a>
            <a href="javascript:;" title="刷新" id="refresh" class="Refresh-sign"></a>
            <a href="javascript:;" title="删除" id="delete" class="delete-sign"></a>
        </div>
    </div>
    <div class="portlet-body">
        <div class="tabbable tabbable-tabdrop">
            <div class="tab-content">
                <div class="tab-pane active" id="tab1">
                    <div class="pagination-reload"></div>
                    <div class="portlet-body pagination-container"
                         data-page-first-store="first-store"
                         data-page-url="/WORKFLOW_BPM_LIST"
                         data-page-template-id="table1-page-template">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{{/content}}

<!-- 页面模态框 -->
{{#content "content-free"}}
<!-- @Override -->
<!--环节设置 模态框-->
<div id="step-list-modal" class="modal container fade modal-scroll" tabindex="-1" aria-hidden="true" data-page-template-id="#step-list-template" data-url="WORKFLOW_BPM_LIST_MODEL">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title"><i class="fa fa-list"></i> <strong>贷款申请-环节列表</strong></h4>
            </div>
            <div class="modal-body" id="model_list">
                <div class="portlet-body">
                    <div class="tabbable tabbable-tabdrop">
                        <div class="tab-content">
                            <div class="tab-pane active" id="tab2">
                                <div class="pagination-reload"></div>
                                <div class="portlet-body pagination-container"
                                     data-page-first-store="first-store"
                                     data-page-url="/WORKFLOW_BPM_LIST_MODEL"
                                     data-page-template-id="step-list-template">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--流程名称 模态框-->
<div id="flow-info-editmodal" class="modal container fade modal-scroll" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title"><i class="fa fa-list"></i> <strong></strong></h4>
            </div>
            <div class="modal-body">
                <form action="${base}/bpm/flowupdatex" method="POST" role="form" class="form-horizontal">
                    <div class="form-body">
                        <input type="hidden" name="id" readonly="readonly" required>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="col-md-2 control-label">流程名称:</label>
                                    <div class="col-md-10">
                                        <input name="name" type="text" class="form-control input-sm" maxlength="30" placeholder="请输入流程名称..." required>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="col-md-2 control-label">流程标识:</label>
                                    <div class="col-md-10">
                                        <input name="key" type="text" class="form-control input-sm" readonly>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="col-md-2 control-label">流程说明:</label>
                                    <div class="col-md-10">
                                        <textarea name="description" class="form-control input-sm" maxlength="100" placeholder="请输入流程说明..." rows="5" cols="3"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="col-md-2 control-label">plugin-js:</label>
                                    <div class="col-md-10">
                                        <input name="pluginJs" type="text" class="form-control input-sm" placeholder="请输入关联js...">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="col-md-2 control-label">plugin-css:</label>
                                    <div class="col-md-10">
                                        <input name="pluginCss" type="text" class="form-control input-sm" placeholder="请输入关联css...">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline dark ok">确认</button>
                <button type="button" data-dismiss="modal" class="btn btn-outline dark">取消</button>
            </div>
        </div>
    </div>
</div>
<!--贷款申请简要录入-配置 模态框-->
<div id="step-config-modal" class="modal container fade modal-scroll" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title"><i class="fa fa-list"></i><strong>贷款申请简要录入-配置</strong></h4>
            </div>
            <div class="modal-body">
                <form action="${base}/workflow/stepconfig/update" method="POST" role="form" class="form-horizontal">
                    <div class="form-body">
                        <input type="hidden" name="id" readonly="readonly">
                        <input type="hidden" name="flowKey" readonly="readonly">
                        <input type="hidden" name="flowInfoId" readonly="readonly">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="col-md-2 control-label">流程名称:</label>
                                    <div class="col-md-10">
                                        <input name="flowName" type="text" class="form-control input-sm" readonly>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="col-md-2 control-label">运行系统:</label>
                                    <div class="col-md-10"><input name="runSystem" type="text" class="form-control input-sm" readonly></div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="col-md-2 control-label">环节名称:</label>
                                    <div class="col-md-10">
                                        <input name="stepName" type="text" class="form-control input-sm" readonly>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="col-md-2 control-label">环节标识:</label>
                                    <div class="col-md-10"><input name="stepKey" type="text" class="form-control input-sm" readonly></div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="col-md-2 control-label">环节说明:</label>
                                    <div class="col-md-10"><textarea name="stepDesc" class="form-control input-sm" rows="3" cols="5"></textarea></div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="col-md-2 control-label">环节类型:</label>
                                    <div class="col-md-10"><input name="stepType" type="text" class="form-control input-sm" readonly></div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="col-md-2 control-label">操作视图:</label>
                                    <div class="col-md-10">
                                        <input type="hidden" name="relView" readonly/>
                                        <input data-target="#relview-sel-modal" data-toggle="modal" name="relViewDis" type="text" class="form-control input-sm" readonly></div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <input name="handlePositionName" type="hidden" id="handlePositionName" readonly/>
                                    <label class="col-md-2 control-label">参与岗位:</label>
                                    <div class="col-md-10" id="b-p-positionNames">
                                        <select multiple="multiple" data-error-container="#b-p-positionNames" name="handlePositionKeys" class="form-control select2 selectloader-positions"
                                                style="position:absolute;width:100%;" data-selectloader-store="positions" data-selectloader-vkey="postNo" data-selectloader-tkey="postNa">
                                            <option value="">请选择...</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <input name="handleUrname" id="handleUrname" type="hidden" readonly>
                                    <label class="col-md-2 control-label">参与人:</label>
                                    <div class="col-md-10">
                                        <input name="handleUlname" type="text" class="form-control input-sm candidateUsers" data-text-input="#handleUrname" data-key-type="USER" data-jstreemultiselect-store="candidateUsers" data-jstreeloader-target="#jstree-panel" placeholder="参与人,多个人以,分隔...">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="col-md-2 control-label">会签:</label>
                                    <div class="col-md-10">
                                        <input type="checkbox" name="signIn" class="form-control input-sm"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row signInStrategy hide">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="col-md-2 control-label">会签策略:</label>
                                    <div class="col-md-10">
                                        <select name="signInStrategy" readonly class="form-control selectloader-signinstrategy" data-selectloader-store="signinstrategy"
                                                data-selectloader-vkey="name" data-selectloader-tkey="desc" tabindex="1">
                                            <option value="">请选择...</option>
                                            <option value="1">所有人同意则为通过，若有一个人不同意则为拒绝</option>
                                            <option value="2">超过二分之一同意为通过，不足或者等于二分之一为拒绝</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="col-md-2 control-label">提交方式:</label>
                                    <div class="col-md-10">
                                        <input type="hidden" name="commitWayValue" id="commitWayValue" readonly/>
                                        <div class="radio-list commitway" data-radioloader-name="commitWayKey" data-text-input="#commitWayValue" data-radioloader-val="1" data-radioloader-store="commitway" data-radioloader-vkey="code" data-radioloader-tkey="name"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="col-md-2 control-label">分单方式:</label>
                                    <div class="col-md-10">
                                        <input type="hidden" name="assignWayValue" id="assignWayValue" readonly/>
                                        <div class="radio-list assignway" data-radioloader-name="assignWayKey" data-text-input="#assignWayValue" data-radioloader-val="1" data-radioloader-store="assignway" data-radioloader-vkey="code" data-radioloader-tkey="name"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row autoAssignStrategy hide">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="col-md-2 control-label">分单策略:</label>
                                    <div class="col-md-10">
                                        <select name="autoAssignStrategy" readonly class="form-control selectloader-autoassignstrategy" data-selectloader-store="autoassignstrategy"
                                                data-selectloader-vkey="name" data-selectloader-tkey="desc" tabindex="1">
                                            <option value="">请选择...</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="col-md-2 control-label">事件处理器:</label>
                                    <div class="col-md-10">
                                        <input type="hidden" name="plugjson" readonly/>
                                        <textarea readonly data-target="#plug-sel-modal" data-toggle="modal" name="plugjsonDis" class="form-control input-sm" rows="3" cols="5"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="col-md-2 control-label">里程碑:</label>
                                    <div class="col-md-10">
                                        <input type="checkbox" value="Y" name="mileStone" class="form-control input-sm"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="col-md-2 control-label">取消时长(秒):</label>
                                    <div class="col-md-10">
                                        <input type="input" name="cancelTime" class="form-control input-sm number" maxlength="30" placeholder="请输入取消时长..."/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline dark ok">确认</button>
                <button type="button" data-dismiss="modal" class="btn btn-outline dark">取消</button>
            </div>
        </div>
    </div>
</div>
{{/content}}

<!-- 页面组件模板 -->
{{#content "content-component"}}
<!-- @Override -->
<!--页面列表 内容-->
<script type="text/x-handlebars-template" id="table1-page-template">
    {{{{raw}}}}
    <div class="table-scrollable">
        <table class="table table-striped table-bordered table-hover">
            <thead>
            <tr>
                <th>选择</th>
                <th> 流程名称 </th>
                <th> 流程标识 </th>
                <th> 流程描述 </th>
                <th> 发布状态 </th>
                <th> 运行状态 </th>
                <th> 版本号 </th>
                <th> 创建时间 </th>
                <th> 操作 </th>
            </tr>
            </thead>
            <tbody>
            {{#each page.content}}
            <tr>
                <td>
                    <input type="radio" name="sel_radio" class="icheck" value="{{id}}"/>
                </td>
                <td> <a href="#" data-target="#flow-info-editmodal" data-toggle="modal" data-view-flow-name="{{name}}" data-view-flow-id="{{id}}">{{name}}</a> </td>
                <td> {{key}} </td>
                <td> {{description}} </td>
                <td> {{deployStatus-text}} </td>
                <td> {{runStatus-text}} </td>
                <td> {{version}} </td>
                <td> {{createTime}} </td>
                <td>
                    <a href="javascript:;" class="activiti-edit" data-path="${base}" data-activiti-id="{{id}}">编辑</a>
                    <a href="#" data-target="#step-list-modal" data-toggle="modal" data-flow-id="{{id}}" data-flow-key="{{key}}" data-flow-name="{{name}}">环节设置</a>
                    <a href="#" class="activiti-view" data-path="${base}" data-activiti-id="{{id}}">流程图</a>
                    <a href="javascript:;" onclick="window.location.href='${base}/activiti/export-xml/{{id}}'" data-activiti-export-xml-id="{{id}}">导出xml</a>
                    <a href="javascript:;" onclick="window.location.href='${base}/activiti/export-json/{{id}}'" data-activiti-export-xml-id="{{id}}">导出json</a>
                    <a href="javascript:;" class="activiti-deploy" data-id="{{id}}" data-activiti-id="{{id}}">部署</a>
                    <a href="javascript:;" class="activiti-disable" data-id="{{id}}" data-activiti-id="{{id}}">挂起</a>
                    <a href="javascript:;" class="activiti-enable" data-id="{{id}}" data-activiti-id="{{id}}">启用</a>
                </td>
            </tr>
            {{/each}}
            </tbody>
        </table>
    </div>
    {{{{/raw}}}}
    {{> pager}}
</script>
<!--环节设置 模态框列表 内容-->
<script type="text/x-handlebars-template" id="step-list-template">
    {{{{raw}}}}
    <div class="table-scrollable">
        <table class="table table-striped table-bordered table-hover">
            <thead>
            <tr>
                <th>选择</th>
                <th> 环节名称 </th>
                <th> 环节标识 </th>
                <th> 环节类型 </th>
                <th> 设置 </th>
            </tr>
            </thead>
            <tbody>
            {{#each page.content}}
            <tr>
                <th> {{list-rowindex}} </th>
                <td> <a href="#" data-target="#step-config-modal" data-toggle="modal" data-flow-key="{{flowKey}}" data-flow-name="{{flowName}}" data-step-type="{{stepType}}" data-step-name="{{stepName}}" data-step-desc="{{stepDesc}}" data-step-key="{{stepKey}}">{{stepName}}</a> </td>
                <td> {{stepKey}} </td>
                <td> {{stepType}} </td>
                <td> <a href="#" data-step-key="{{stepKey}}">表单项处理</a> </td>
            </tr>
            {{/each}}
            </tbody>
        </table>
    </div>
    {{{{/raw}}}}
</script>
{{/content}}

{{/extend}}